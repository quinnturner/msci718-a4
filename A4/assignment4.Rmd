---
title: Assignment 4 - Analyzing Student Alcohol Consumption
author:
   - Stephen Quinn Turner - sqturner - 20576575
   - Rebecca Rayner - rsrayner - 20562488
   - Yusuf Khaled - yhbkhale - 20508841
   - Samantha Villaluz - skvillal - 20582656
date: "Friday, April 05, 2019"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
```


Notes:

**affect size**
Don't need to test for normality for all
**Practical significance**
**Simpson's Paradox**


# Background

For our final assignment for MSCI 718, we are asked to analyze a dataset of our choice and generate useful insights.

We chose to analyze student alcohol consumption in secondary schools. The data includes social, gender and study data from secondary school students. The data was provided by the UC Irving Machine Learning Repository and is available on [Kaggle](https://www.kaggle.com/uciml/student-alcohol-consumption).

This analysis will use two datasets, one set includes information on students taking a math course and the other includes information on students taking a Portugese course.


# Objectives

Our objective for this analysis was to analyze _______________.


# Analysis

Let's begin by importing the dataset, defining the variables, and exploring the data.

```{r}
matData <- read.csv("student-alcohol-consumption/student-mat.csv")
porData <- read.csv("student-alcohol-consumption/student-por.csv")
```

Here is a description of the variables in the dataset (provided by the original Kaggle source):

1. school - student's school (binary: 'GP' - Gabriel Pereira or 'MS' - Mousinho da Silveira)
1. sex - student's sex (binary: 'F' - female or 'M' - male)
1. age - student's age (numeric: from 15 to 22)
1. address - student's home address type (binary: 'U' - urban or 'R' - rural)
1. famsize - family size (binary: 'LE3' - less or equal to 3 or 'GT3' - greater than 3)
1. Pstatus - parent's cohabitation status (binary: 'T' - living together or 'A' - apart)
1. Medu - mother's education (numeric: 0 - none, 1 - primary education (4th grade), 2 - 5th to 9th grade, 3 - secondary education or 4 - higher education)
1. Fedu - father's education (numeric: 0 - none, 1 - primary education (4th grade), 2 - 5th to 9th grade, 3 - secondary education or 4 - higher education)
1. Mjob - mother's job (nominal: 'teacher', 'health' care related, civil 'services' (e.g. administrative or police), 'at_home' or 'other')
1. Fjob - father's job (nominal: 'teacher', 'health' care related, civil 'services' (e.g. administrative or police), 'at_home' or 'other')
1. reason - reason to choose this school (nominal: close to 'home', school 'reputation', 'course' preference or 'other')
1. guardian - student's guardian (nominal: 'mother', 'father' or 'other')
1. traveltime - home to school travel time (numeric: 1 - <15 min., 2 - 15 to 30 min., 3 - 30 min. to 1 hour, or 4 - >1 hour)
1. studytime - weekly study time (numeric: 1 - <2 hours, 2 - 2 to 5 hours, 3 - 5 to 10 hours, or 4 - >10 hours)
1. failures - number of past class failures (numeric: n if 1<=n<3, else 4)
1. schoolsup - extra educational support (binary: yes or no)
1. famsup - family educational support (binary: yes or no)
1. paid - extra paid classes within the course subject (Math or Portuguese) (binary: yes or no)
1. activities - extra-curricular activities (binary: yes or no)
1. nursery - attended nursery school (binary: yes or no)
1. higher - wants to take higher education (binary: yes or no)
1. internet - Internet access at home (binary: yes or no)
1. romantic - with a romantic relationship (binary: yes or no)
1. famrel - quality of family relationships (numeric: from 1 - very bad to 5 - excellent)
1. freetime - free time after school (numeric: from 1 - very low to 5 - very high)
1. goout - going out with friends (numeric: from 1 - very low to 5 - very high)
1. Dalc - workday alcohol consumption (numeric: from 1 - very low to 5 - very high)
1. Walc - weekend alcohol consumption (numeric: from 1 - very low to 5 - very high)
1. health - current health status (numeric: from 1 - very bad to 5 - very good)
1. absences - number of school absences (numeric: from 0 to 93)

These grades are related with the course subject, Math or Portuguese:

- G1 - first period grade (numeric: from 0 to 20)
- G2 - second period grade (numeric: from 0 to 20)
- G3 - final grade (numeric: from 0 to 20, output target)

Based on the description of the variables, we deemed that it was appropriate to make the following transformations to the imported dataset:

1. Add variable `Talc` _<2 - very low to 10 - very high> (Sum of students' drinking habits)_
1. Add factor `famrel` _<1 - very bad to 5 - excellent>_
1. Add factor `freetime` _<1 - very low to 5 - very high>_
1. Add factor `goout` _<1 - very low to 5 - very high>_
1. Add factor `health` _<1 - very bad to 5 - very good>_

```{r, include=FALSE}
matData$Talc <- matData$Walc + matData$Dalc
porData$Talc <- porData$Walc + porData$Dalc

matData$famrel <- factor(matData$famrel, levels = c("1","2","3","4","5"),
                    labels = c("Very Bad","Bad","Okay","Good","Excellent"))
porData$famrel <- factor(porData$famrel, levels = c("1","2","3","4","5"),
                    labels = c("Very Bad","Bad","Okay","Good","Excellent"))
matData$freetime <- factor(matData$freetime, levels = c("1","2","3","4","5"),
                    labels = c("Very Low","Low","Moderate","High","Very High"))
porData$freetime <- factor(porData$freetime, levels = c("1","2","3","4","5"),
                    labels = c("Very Low","Low","Moderate","High","Very High"))
matData$goout <- factor(matData$goout, levels = c("1","2","3","4","5"),
                    labels = c("Very Low","Low","Moderate","High","Very High"))
porData$goout <- factor(porData$goout, levels = c("1","2","3","4","5"),
                    labels = c("Very Low","Low","Moderate","High","Very High"))
matData$health <- factor(matData$health, levels = c("1","2","3","4","5"),
                    labels = c("Very Bad","Bad","Okay","Good","Very Good"))
porData$health <- factor(porData$health, levels = c("1","2","3","4","5"),
                    labels = c("Very Bad","Bad","Okay","Good","Very Good"))

matData$Talc2 <- sapply(matData$Talc, function(x) if(x <= 2) 'No' else if(x<=6) 'Low' else 'High')
matData$Talc2 <- factor(matData$Talc2, levels = c("No", "Low", "High"), 
                        labels = c("None", "Low Alc", "High Alc"))

porData$Gavg <- rowMeans(cbind(porData$G1,porData$G2,porData$G3))
matData$Gavg <- rowMeans(cbind(matData$G1,matData$G2,matData$G3))
```

Additional note: there are 382 students that belong to both datasets so there are only 13 students who took math did not take Portugese. It is not likely or appropriate that we can find statistically or practically significant differences between the students who took math and not Portugese or vice-versa. This is because we don't know whether the remaining Portugese students took math or not since they could have been in another class that was not included in the data collection process.

Here, we get a glimpse of the dataset with the appropriate factors and derived variables.

```{r}
head(matData)
head(porData)
```

## Set up

```{r}
# Length of each dataframe
matDataLen <- dim(matData)[1]
porDataLen <- dim(porData)[1]
```

## Analysis
```{r}
#Contrasts
contrast1 <- c(-2, 1, 1)
contrast2 <- c(0, -1, 1)
contrasts(matData$Talc2) <- cbind(contrast1, contrast2)
colnames(attr(matData$Talc2, "contrasts")) <- c("Alcohol v No Alcohol", "High v Low")
contrasts(matData$Talc2)
HealthEffect <- aov(health ~ Talc2, data=matData)
summary.lm(HealthEffect)
```

```{r}
averageGradeModel<-lm(Gavg~., data=cbind(porData[,1:30], porData[35]))
summary(averageGradeModel)
```

```{r}
ggplot(porData, aes(x=Walc, y=Gavg, group=Walc))+
  geom_boxplot()+
  theme(legend.position="none")+
  xlab("Daily alcohol consumption on weekends")+
  ylab("Average Grades")+
  ggtitle("Average Grade")

```