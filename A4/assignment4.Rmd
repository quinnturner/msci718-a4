---
title: Assignment 4 - Analyzing Student Alcohol Consumption
author:
   - Stephen Quinn Turner - sqturner - 20576575
   - Rebecca Rayner - rsrayner - 20562488
   - Yusuf Khaled - yhbkhale - 20508841
   - Samantha Villaluz - skvillal - 20582656
date: "Friday, April 05, 2019"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(car)
```



# Objectives

For our final assignment for MSCI 718, we are asked to analyze a dataset of our choice and generate useful insights.

We chose to analyze student alcohol consumption in secondary schools. The data includes social, gender and study data from secondary school students. The data was provided by the UC Irving Machine Learning Repository and is available on [Kaggle](https://www.kaggle.com/uciml/student-alcohol-consumption).

Our objective for this analysis was to analyze the correlation between alcohol consumption, and other characteristics among Portuguese post-secondary school students.

# Hypothesis
From the set of variables collected in this dataset, our hypothesis is that there is correlation between alcohol consumption and each of the following variables: health, goout, failures, grades (G3). Each of these hypothesis come from personal experience and/or curiosity. As students we know that when you go out you more you tend to drink more, which can cause you to sleep less, which can impact your grades and your overall health. For this reason we felt the variables chosen had a good chance of showing some correlation with alcohol consumption.

<<<<<<< HEAD
Our objective for this analysis was to analyze the correlation between alcohol consumption, and other characteristics among Portuguese post-secondary school students.
=======
# Background
>>>>>>> 7a5252029a2ea81d08460aa2566b582eaba88d3b

This analysis will use two datasets, one set includes information on students taking a math course (matData) and the other includes information on students taking a Portugese course (porData).

# Analysis

Let's begin by importing the dataset, defining the variables, and exploring the data.

```{r}
porData <- read.csv("student-alcohol-consumption/student-por.csv")
```

There are 30+ variables in this dataset. Descriptions of a select group of variables in the dataset are shown below (provided by the original Kaggle source):

* school - student's school (binary: 'GP' - Gabriel Pereira or 'MS' - Mousinho da Silveira)
* sex - student's sex (binary: 'F' - female or 'M' - male)
* age - student's age (numeric: from 15 to 22)
* famsize - family size (binary: 'LE3' - less or equal to 3 or 'GT3' - greater than 3)
* Pstatus - parent's cohabitation status (binary: 'T' - living together or 'A' - apart)
* failures - number of past class failures (numeric: n if 1<=n<3, else 4)
* higher - wants to take higher education (binary: yes or no)
* goout - going out with friends (numeric: from 1 - very low to 5 - very high)
* Dalc - workday alcohol consumption (numeric: from 1 - very low to 5 - very high)
* Walc - weekend alcohol consumption (numeric: from 1 - very low to 5 - very high)
* health - current health status (numeric: from 1 - very bad to 5 - very good)
* absences - number of school absences (numeric: from 0 to 93)

These grades are related with the course subject, Math or Portuguese:

- G1 - first period grade (numeric: from 0 to 20)
- G2 - second period grade (numeric: from 0 to 20)
- G3 - final grade (numeric: from 0 to 20, output target)

Based on the description of the variables, we deemed that it was appropriate to make the following transformations to the imported dataset:

* Add variable `Talc` _<2 - very low to 10 - very high> (Sum of students' drinking habits)_
--> factored so that 2 = No Alcohol, 3-6 = Low Alcohol, 7-10 = High Alcohol
* Add factor `famrel` _<1 - very bad to 5 - excellent>_
* Add factor `freetime` _<1 - very low to 5 - very high>_
* Add factor `goout` _<1 - very low to 5 - very high>_
* Add factor `health` _<1 - very bad to 5 - very good>_

```{r, include=FALSE}
porData$Talc <- porData$Walc + porData$Dalc

porData$famrel <- factor(porData$famrel, levels = c("1","2","3","4","5"),
                    labels = c("Very Bad","Bad","Okay","Good","Excellent"))
porData$freetime <- factor(porData$freetime, levels = c("1","2","3","4","5"),
                    labels = c("Very Low","Low","Moderate","High","Very High"))
porData$goout <- factor(porData$goout, levels = c("1","2","3","4","5"),
                    labels = c("Very Low","Low","Moderate","High","Very High"))
porData$health <- factor(porData$health, levels = c("1","2","3","4","5"),
                    labels = c("Very Bad","Bad","Okay","Good","Very Good"))

porData$Talc2 <- sapply(porData$Talc, function(x) if(x <= 2) 'No' else if(x<=6) 'Low' else 'High')
porData$Talc2 <- factor(porData$Talc2, levels = c("No", "Low", "High"),
                        labels = c("None", "Low Alc", "High Alc"))

```

Additional note: there are 382 students that belong to both datasets so there are only 13 students who took math did not take Portugese. It is not likely or appropriate that we can find statistically or practically significant differences between the students who took math and not Portugese or vice-versa. This is because we don't know whether the remaining Portugese students took math or not since they could have been in another class that was not included in the data collection process. Since most students who took math also took Portugese but not vice versa, we will use the Portugese data whenever analyzing traights unrelated to the course type.

Here, we get a glimpse of the dataset with the appropriate factors and derived variables.

```{r}
head(porData)
```

## Set up

```{r}
# Length of each dataframe
porDataLen <- dim(porData)[1]
```

## Visual Exploration
```{r}
# Alcohol Consumption for males and females -> can these groups be together or should they be separated?
ggplot(porData, aes(y=Talc, x=sex)) + geom_point() + geom_jitter(width=0.25)

# Lets examine two of our feature variables and analyze their correlation to alcohol consumption
ggplot(porData, aes(Talc))+
  geom_bar(aes(fill = health), position = position_stack(reverse = TRUE))+
  xlab("Alcohol consumption")+
  ylab("Count")+
  ggtitle("Alcohol consumption seems to be correlated with general health")

ggplot(porData, aes(Talc))+
  geom_bar(aes(fill = goout), position = position_stack(reverse = TRUE))+
  xlab("Alcohol consumption")+
  ylab("Count")+
  ggtitle("Alcohol consumption seems to be correlated with going out")

```
From this we can see that overall women drink less than men, and there are especially more men who drink higher levels of alcohol. This may mean that we want to separate by sex when looking at alcohol effects. We also see that our initial assumptions about which feature variables to examine could be vindicated, based on the fact that both going out and general health seem to have some correlation with alcohol consumption - at least upon visual inspection.

Now that we've set up our data, and have some confidence going forward that  our initially chosen hypothesis variables could show some correlation to alcohol consumption, let's move forward with our analysis.

# Analysis: Contrasts, Effect Size and Anova
The four variables we deemed interesting to assess against alcohol consumption were
1. Health
2. Past Class Failures
3. Frequency of Going Out
4. Final Grade in Class

We have broken down the analysis in three parts:

1. Contrasts
we wish to explore how each of the four variables differ against heavy vs. moderate drinkers vs. non-drinkers. The data is segmented in two different ways to ensure that statistical significance is not only due to a high number of data points in the whole dataset.
* Gender (Male, Female)
* Alcohol Consumption (None, Low Alcohol, High Alcohol)

2. Effect Size

3. Anova

For may of these variables, there is a statically significant effect found when all data is used, but many of these effects disappear when data is separated by sex. This could be that the statistical significance is only due to the higher number of datapoints, but that there isn't practical significance. Conversely, for going out and alcohol consumption there is a statiscially significant results when split by sex which suggests that the correlation is stronger.

```{r}
## Failures vs Alcohol Consumption

##Separate by sex
porData.Male <- subset(porData, porData$sex=="M")
porData.Female <- subset(porData, porData$sex=="F")

FailureEffect.Total <- aov(as.numeric(failures) ~ Talc2, data=porData)
FailureEffect.Male <- aov(as.numeric(failures) ~ Talc2, data=porData.Male)
FailureEffect.Female <- aov(as.numeric(failures) ~ Talc2, data=porData.Female)
summary.lm(FailureEffect.Total)
summary.lm(FailureEffect.Male)
summary.lm(FailureEffect.Female)
```

```{r include = FALSE}
#Contrasts
contrast1 <- c(-2, 1, 1)
contrast2 <- c(0, -1, 1)
contrasts(porData$Talc2) <- cbind(contrast1, contrast2)
colnames(attr(porData$Talc2, "contrasts")) <- c("Alcohol v No Alcohol", "High v Low")
contrasts(porData$Talc2)

## Health vs Alcohol Consumption
HealthEffect.Total <- aov(as.numeric(health) ~ Talc2, data=porData)
HealthEffect.Male <- aov(as.numeric(health) ~ Talc2, data=porData.Male)
HealthEffect.Female <- aov(as.numeric(health) ~ Talc2, data=porData.Female)
summary.lm(HealthEffect.Total)
summary.lm(HealthEffect.Male)
summary.lm(HealthEffect.Female)

##Goout vs Alcohol Consumption
GooutEffect.Total <- aov(as.numeric(goout) ~ Talc2, data=porData)
GooutEffect.Male <- aov(as.numeric(goout) ~ Talc2, data=porData.Male)
GooutEffect.Female <- aov(as.numeric(goout) ~ Talc2, data=porData.Female)
summary.lm(GooutEffect.Total)
summary.lm(GooutEffect.Male)
summary.lm(GooutEffect.Female)

##Grade vs Alcohol Consumption
GradeEffect.Total <- aov(G3 ~ Talc2, data=porData)
GradeEffect.Male <- aov(G3 ~ Talc2, data=porData.Male)
GradeEffect.Female <- aov(G3 ~ Talc2, data=porData.Female)
summary.lm(GradeEffect.Total)
summary.lm(GradeEffect.Male)
summary.lm(GradeEffect.Female)

GradeEffect.Male <- aov(G3 ~ Talc2, data=porData.Male)
GradeEffect.Female <- aov(G3 ~ Talc2, data=porData.Female)
summary.lm(GradeEffect.Total)
summary.lm(GradeEffect.Male)
summary.lm(GradeEffect.Female)
```

To Do: Add discussion

For may of these variables, there is a statically significant effect found when all data is used, but many of these effects disappear when data is separated by sex. This could be that the statistical significance is only due to the higher number of datapoints, but that there isn't practical significance. Conversely, for going out and alcohol consumption there is a statiscially significant results when split by sex which suggests that the correlation is stronger.
>>>>>>> 7a5252029a2ea81d08460aa2566b582eaba88d3b

To Do: Discussion

Maybe interesting to say that because we can only say if these are correlated but not what the causation is, there could be reason to believe that either causes either: i.e. people could get worse grades because they drink or people may drink more because they get worse grades.
